# PDCAチェックリスト

**Date**: 2026年1月15日  
**Project**: 少量音素コーパスを用いた日本語TTS構築実験  
**Period**: 2026年1月15日 - 2026年1月22日（7日間）  
**Version**: 1.0

---

## プロジェクト概要

### 研究目的
音素カバレッジとコーパス設計（4文 vs 80文など）が、fine-tuningされた日本語TTSモデルの出力品質に与える影響を、客観指標（MCD, log-F0 RMSE, CER）を用いて明らかにする。

### 実験条件（4条件）
- **E1**: 80文コーパス（データ量最大）
- **E2**: 37音素4文（音素カバレッジ最大、データ量最小）
- **E3**: ランダム4文（対照群）
- **E4**: 上位10文（音素特徴量上位）

### 全体スケジュール
- **1/15-1/16 (2日)**: 環境構築・データ準備（Phase 1, 2）
- **1/17-1/19 (3日)**: Fine-tuning実験（Phase 3, 4）
- **1/20-1/21 (2日)**: 評価・分析（Phase 5, 6）
- **1/22 (1日)**: ドキュメント整備（Phase 7）

---

## マイルストーン確認表

| 日付 | マイルストーン | 達成基準 |
|------|---------------|----------|
| **1/16終了時点** | Phase 1, 2完了 | - ESPnet2/StyleTTS2が正常にインストール・動作確認済み<br>- JVS parallel100データが配置済み<br>- 音素分析完了、4条件のコーパス選定完了 |
| **1/18終了時点** | Phase 3完了、Phase 4最低2条件完了 | - データ前処理完了<br>- E1（80文）、E2（37音素4文）のfine-tuning完了 |
| **1/20終了時点** | Phase 4全条件、Phase 5, 6完了 | - 全4条件のfine-tuning完了<br>- 音声合成完了<br>- 客観評価（MCD, F0 RMSE）完了 |
| **1/22終了時点** | Phase 7完了、全ドキュメント整備 | - 結果可視化・分析完了<br>- 全ドキュメント整備完了 |

---

## リスク対応フロー

### 期限リスクへの対応
- **1/18時点で進捗50%未満の場合**: 条件を4→3に削減（ランダム4文を除外）
- **1/20時点で評価未完了の場合**: MCD/F0のみに絞る（CERは削除）
- **1/21時点で分析未完了の場合**: 基本統計のみ、図表は最小限に

### 主要リスクと対応
- **ESPnet2環境構築失敗**: StyleTTS2へ早期切り替え
- **GPU OOM**: バッチサイズ削減、mixed precision (fp16)使用
- **学習が収束しない**: 学習率を1/10に下げる、ステップ数調整
- **合成音声が生成されない**: チェックポイント確認、モデル読み込み確認

---

## 日次PDCA

---

### 2026年1月15日（木）Day 1

#### Plan（計画）

**今日のゴール**
- Phase 1（環境構築・データ準備）の開始
- ESPnet2/StyleTTS2の選定と環境構築

**やるタスク**（設計レベルメモ Phase 1参照）
- [x] ESPnet2とStyleTTS2の比較調査（公式ドキュメント、日本語対応状況、評価スクリプトの有無）
- [x] TTS基盤の選定決定（ESPnet2優先、失敗時はStyleTTS2）
- [x] 既存venv環境の確認と有効化（`/home/gohan/.venv`、Python 3.12.9、PyTorch 2.5.1+cu121既存）
- [x] PyTorch動作確認（CUDA認識、GPU利用確認）※既にインストール済みのため確認のみ
- [x] requirements.txtの作成（TTS関連パッケージのみ記載）
- [x] ESPnet2のインストール（またはStyleTTS2）
- [x] 依存ライブラリのインストール（pyopenjtalk, librosa, soundfile, matplotlib, seaborn等）
- [x] JVS parallel100データのダウンロード・配置確認

**詰まりそうなポイント**
- ESPnet2環境構築失敗（影響度：高）→ StyleTTS2へ早期切り替え
- GPU認識不可（影響度：低）→ PyTorchは既にインストール済み、確認のみ実施

#### Do（実行）

実行ログ（時間＋内容）:
```
[2026-01-18] プロジェクト構造の確認、ディレクトリ作成
[2026-01-18] PyTorch動作確認（CUDA認識済み）
[2026-01-18] 依存ライブラリのインストール完了（pyopenjtalk, librosa, soundfile等）
[2026-01-18] src/phoneme_analysis.py作成完了
[2026-01-18] src/corpus_selection.py作成完了
[2026-01-18] src/preprocess.py作成完了
[2026-01-18] ESPnet2のインストール完了（pip install -e "./espnet[tts]"）
[2026-01-18] JVSデータの配置確認完了
[2026-01-18] ESPnet2動作確認完了（TTSモジュールインポート成功）
```

#### Check（確認）

**できたこと / できなかったこと**
- ✓ プロジェクト構造の作成（src/, scripts/, configs/, tests/, data/, results/, outputs/）
- ✓ PyTorch動作確認（CUDA 12.1認識済み）
- ✓ 依存ライブラリのインストール完了
- ✓ Phase 2のスクリプト作成完了（phoneme_analysis.py, corpus_selection.py）
- ✓ Phase 3のスクリプト作成完了（preprocess.py）
- ✓ ESPnet2のインストール完了（TTS機能付き）
- ✓ JVSデータの準備完了（ダウンロード・配置済み）


**想定との差分**
- スクリプト作成が順調に進んだため、Phase 2, 3のスクリプトを先に作成
- ESPnet2のインストールは想定通り完了（既存venvに直接インストール）
- JVSデータの準備はユーザーが事前に実施済み


#### Action（改善）

**次回変えること**
1. ✅ ESPnet2のインストール完了
2. ✅ JVS parallel100データの準備完了
3. 次のセッションで音素分析とコーパス選定を実行

---

### 2026年1月16日（金）Day 2

#### Plan（計画）

**今日のゴール**
- Phase 1完了、Phase 2（音素分析・コーパス選定）完了
- マイルストーン1達成

**やるタスク**（設計レベルメモ Phase 1, 2参照）
- [ ] 簡単な動作テスト（ESPnet2のサンプル実行またはStyleTTS2のデモ実行）
- [x] requirements.txtの作成・更新
- [x] `src/phoneme_analysis.py`の作成（音素ラベル抽出スクリプト）
- [ ] pyopenjtalkを使用した100文の音素列抽出（JVSデータ準備後に実行）
- [ ] 37音素インベントリの確認・リスト化（JVSデータ準備後に実行）
- [ ] 各文の音素分布（ユニーク音素数、頻度）を計算（JVSデータ準備後に実行）
- [ ] 音素分布データをJSON/CSV形式で保存（`results/phoneme_distribution.json`）（JVSデータ準備後に実行）
- [x] `src/corpus_selection.py`の作成（コーパス選定スクリプト）
- [ ] 4条件のコーパス選定（80文/37音素4文/ランダム4文/上位10文）（JVSデータ準備後に実行）
- [ ] 4条件の文IDリストをJSON形式で保存（`results/corpus_selection.json`）（JVSデータ準備後に実行）

**詰まりそうなポイント**
- 37音素カバー4文が存在しない（影響度：中）→ 貪欲法を再実行、5文に拡張も検討
- 音素解析エラー（影響度：中）→ pyopenjtalkの設定確認、エラー文の除外

#### Do（実行）

実行ログ（時間＋内容）:
```
[2026-01-18] phoneme_analysis.pyの修正（テキストファイル読み込み、音素抽出）
[2026-01-18] 音素分析スクリプト実行完了（38音素インベントリ確認）
[2026-01-18] コーパス選定スクリプト実行完了（4条件のコーパス選定完了）
[2026-01-18] 結果ファイル保存完了（phoneme_distribution.json, corpus_selection.json）
```

#### Check（確認）

**できたこと / できなかったこと**
- ✓ pyopenjtalkを使用した100文の音素列抽出完了
- ✓ 38音素インベントリの確認・リスト化完了（pau含む）
- ✓ 各文の音素分布（ユニーク音素数、頻度）を計算完了
- ✓ 音素分布データをJSON/CSV形式で保存完了
- ✓ 4条件のコーパス選定完了（80文/37音素4文/ランダム4文/上位10文）
- ✓ 4条件の文IDリストをJSON形式で保存完了
- ✓ テストセットの選定完了（18文）


**想定との差分**
- 音素インベントリが37音素ではなく38音素（pau含む）となった。これはpyopenjtalkの出力形式によるもので、問題なし
- E2（37音素4文）が実際には38音素をカバーしていることを確認。名称は「37音素4文」のまま維持（pauはポーズ音素として重要だが、実験設計上は37音素を想定）


#### Action（改善）

**次回変えること**
1. ✅ Phase 2完了、Phase 3（データ前処理）に進む
2. Phase 3でESPnet2形式のデータリスト生成を実行
3. Phase 4のfine-tuning準備を開始

---

### 2026年1月17日（土）Day 3

#### Plan（計画）

**今日のゴール**
- Phase 3（データ前処理）完了
- Phase 4（Fine-tuning実験）の準備開始

**やるタスク**（設計レベルメモ Phase 3, 4参照）
- [ ] `src/preprocess.py`の作成（データ前処理スクリプト）
- [ ] JVSデータの読み込み（音声ファイル、テキストファイルのパス取得）
- [ ] 音声ファイルの確認（サンプリングレート、チャンネル数、長さ）
- [ ] テキストから音素列への変換（pyopenjtalk使用）
- [ ] ESPnet2形式の`data.list`生成（音声パス、音素列、話者ID）
- [ ] 4条件それぞれの学習用データリスト生成
- [ ] テストセットのデータリスト生成（共通）
- [ ] `src/train.py`の作成（fine-tuningスクリプト）
- [ ] ESPnet2設定ファイル（YAML）の作成（またはStyleTTS2設定）
- [ ] 事前学習モデルのダウンロード・配置確認

**詰まりそうなポイント**
- データ形式変換エラー（影響度：中）→ ESPnet2公式ドキュメント確認、サンプルデータでテスト
- GPU OOM（影響度：中）→ バッチサイズ削減、mixed precision (fp16)使用

#### Do（実行）

実行ログ（時間＋内容）:
```
[2026-01-18] preprocess.pyの修正（テキスト読み込み、音素抽出）
[2026-01-18] データ前処理スクリプト実行完了（4条件すべてのデータリスト生成）
[2026-01-18] ESPnet2のfine-tuning方法の調査（JVSレシピ、tts_train.py確認）
[2026-01-18] Phase 4のPlan作成（docs/phase4_plan.md）
```

#### Check（確認）

**できたこと / できなかったこと**
- ✓ JVSデータの読み込み完了（音声ファイル、テキストファイルのパス取得）
- ✓ 音声ファイルの確認完了（24kHz、モノラル、正常に読み込み可能）
- ✓ テキストから音素列への変換完了（pyopenjtalk使用、kana=False）
- ✓ ESPnet2形式のdata.list生成完了（4条件すべて）
- ✓ テストセットのデータリスト生成完了
- ✓ ESPnet2のfine-tuning方法の調査完了
- ⚠️ ESPnet2形式（Kaldi形式）への変換が必要（次のステップ）


**想定との差分**
- データ形式がESPnet2のKaldi形式ではなく、独自のJSONL形式（data.list）で生成した
- ESPnet2のfine-tuningにはKaldi形式（wav.scp, text, utt2spk等）が必要であることを確認
- データ形式変換スクリプトの作成が必要


#### Action（改善）

**次回変えること**
1. ✅ Phase 3完了、Phase 4のPlan作成完了
2. Phase 4でESPnet2形式へのデータ変換スクリプトを作成
3. ESPnet2の設定ファイル（YAML）を作成
4. 事前学習モデルのダウンロード

---

### 2026年1月18日（日）Day 4

#### Plan（計画）

**今日のゴール**
- Phase 4の最低2条件（E1, E2）のfine-tuning完了
- マイルストーン2達成

**やるタスク**（設計レベルメモ Phase 4参照）
- [ ] 学習スクリプトの実装（チェックポイント保存、ログ出力）
- [ ] 乱数シード固定の実装
- [ ] バッチサイズの決定（GPU OOM回避のため小規模テスト実行）
- [ ] 学習率の設定確認
- [ ] `scripts/run_experiment_80sent.sh`の作成
- [ ] `scripts/run_experiment_4sent_37phonemes.sh`の作成
- [ ] E1（80文）のfine-tuning実行
- [ ] E2（37音素4文）のfine-tuning実行
- [ ] 各条件の学習ログ確認（損失の推移、収束状況）

**詰まりそうなポイント**
- GPU OOM（影響度：中）→ バッチサイズ削減、mixed precision (fp16)使用、gradient accumulation
- 学習が収束しない（影響度：中）→ 学習率を1/10に下げる、ステップ数を増やす
- Fine-tuning時間超過（影響度：高）→ ステップ数削減、条件数削減（ランダム4文を除外）

#### Do（実行）

実行ログ（時間＋内容）:
```
[時刻] 
[時刻] 
[時刻] 
[時刻] 
[時刻] 
```

#### Check（確認）

**できたこと / できなかったこと**
- 


**想定との差分**
- 


#### Action（改善）

**次回変えること**
1. 
2. 
3. 

---

### 2026年1月19日（月）Day 5

#### Plan（計画）

**今日のゴール**
- Phase 4の残り2条件（E3, E4）のfine-tuning完了
- Phase 4全条件完了

**やるタスク**（設計レベルメモ Phase 4参照）
- [ ] `scripts/run_experiment_4sent_random.sh`の作成
- [ ] `scripts/run_experiment_10sent_top.sh`の作成
- [ ] E3（ランダム4文）のfine-tuning実行
- [ ] E4（上位10文）のfine-tuning実行
- [ ] 各条件の学習ログ確認（損失の推移、収束状況）
- [ ] チェックポイントの保存確認
- [ ] チェックポイントからモデルを読み込んで推論可能か確認

**詰まりそうなポイント**
- GPU OOM（影響度：中）→ バッチサイズ削減、mixed precision (fp16)使用
- 学習が収束しない（影響度：中）→ 学習率を1/10に下げる、ステップ数調整
- Fine-tuning時間超過（影響度：高）→ ステップ数削減、条件数削減（ランダム4文を除外）

#### Do（実行）

実行ログ（時間＋内容）:
```
[時刻] 
[時刻] 
[時刻] 
[時刻] 
[時刻] 
```

#### Check（確認）

**できたこと / できなかったこと**
- 


**想定との差分**
- 


#### Action（改善）

**次回変えること**
1. 
2. 
3. 

---

### 2026年1月20日（火）Day 6

#### Plan（計画）

**今日のゴール**
- Phase 5（音声合成）完了
- Phase 6（客観評価）完了（最低MCD, F0 RMSE）
- マイルストーン3達成

**やるタスク**（設計レベルメモ Phase 5, 6参照）
- [ ] `src/synthesize.py`の作成（音声合成スクリプト）
- [ ] テストセットのテキスト読み込み
- [ ] 各条件のチェックポイントからモデル読み込み
- [ ] 音声合成の実行（各条件×各テスト文）
- [ ] 合成音声の保存（`outputs/audio/<condition>/<sentence_id>.wav`）
- [ ] `src/evaluate.py`の作成（客観評価スクリプト）
- [ ] MCD算出スクリプトの実装（またはESPnet2の`evaluate_mcd.py`を利用）
- [ ] log-F0 RMSE算出スクリプトの実装（またはESPnet2の`evaluate_f0.py`を利用）
- [ ] 全条件×全テスト文の評価実行
- [ ] 評価結果の保存（`results/evaluation_results.json`）

**詰まりそうなポイント**
- 合成音声が生成されない（影響度：高）→ チェックポイント確認、モデル読み込み確認、エラーログ確認
- 評価指標の計算エラー（影響度：中）→ 手動で1サンプル計算して検証、ESPnet2公式評価スクリプトと比較
- 評価未完了（影響度：高）→ MCD/F0のみに絞る（CERは削除）

#### Do（実行）

実行ログ（時間＋内容）:
```
[時刻] 
[時刻] 
[時刻] 
[時刻] 
[時刻] 
```

#### Check（確認）

**できたこと / できなかったこと**
- 


**想定との差分**
- 


#### Action（改善）

**次回変えること**
1. 
2. 
3. 

---

### 2026年1月21日（水）Day 7

#### Plan（計画）

**今日のゴール**
- Phase 6の残り（CER評価、統計分析）完了
- Phase 7（結果可視化・分析）完了

**やるタスク**（設計レベルメモ Phase 6, 7参照）
- [ ] CER算出スクリプトの実装（ASR経由、WhisperまたはESPnet2-ASR）
- [ ] 各条件の平均値・標準偏差の計算
- [ ] `src/evaluate_all_conditions.py`の作成（一括評価スクリプト）
- [ ] 評価結果のCSV出力（条件別、指標別）
- [ ] `src/visualize.py`の作成（可視化スクリプト）
- [ ] 評価結果データの読み込み
- [ ] 条件別のMCD比較棒グラフ作成
- [ ] 条件別のlog-F0 RMSE比較棒グラフ作成
- [ ] 条件別のCER比較棒グラフ作成
- [ ] 音素カバレッジ vs 品質指標の散布図作成
- [ ] 図表の保存（`outputs/figures/`）
- [ ] `docs/results.md`の作成（実験結果レポート）

**詰まりそうなポイント**
- 統計分析の時間不足（影響度：低）→ 基本統計のみ、図表は最小限に
- 分析未完了（影響度：高）→ 基本統計のみ、図表は最小限に

#### Do（実行）

実行ログ（時間＋内容）:
```
[時刻] 
[時刻] 
[時刻] 
[時刻] 
[時刻] 
```

#### Check（確認）

**できたこと / できなかったこと**
- 


**想定との差分**
- 


#### Action（改善）

**次回変えること**
1. 
2. 
3. 

---

### 2026年1月22日（木）Day 8

#### Plan（計画）

**今日のゴール**
- Phase 7の残り（考察、設計指針の整理）完了
- 全ドキュメント整備完了
- マイルストーン4達成、プロジェクト完了

**やるタスク**（設計レベルメモ Phase 7参照）
- [ ] 統計分析の実施（条件間の有意差検定等、可能な範囲で）
- [ ] 考察の記述（音素カバレッジと品質の関係、データ量と品質の関係）
- [ ] 最小限コーパス設計指針の整理
- [ ] README.mdの作成・更新
- [ ] 全ドキュメントの最終確認
- [ ] コードの整理・コメント追加
- [ ] Gitリポジトリへのコミット・プッシュ

**詰まりそうなポイント**
- ドキュメント整備の時間不足（影響度：低）→ 最低限のREADMEとresults.mdを優先

#### Do（実行）

実行ログ（時間＋内容）:
```
[時刻] 
[時刻] 
[時刻] 
[時刻] 
[時刻] 
```

#### Check（確認）

**できたこと / できなかったこと**
- 


**想定との差分**
- 


#### Action（改善）

**次回変えること**
1. 
2. 
3. 

---

## 週次振り返り

### 今週の成果
- 


### 今週の課題
- 


### 来週への改善点
- 


---

## 変更履歴

| Date | Version | Changes |
|------|---------|---------|
| 2026-01-15 | 1.0 | 初版作成 |
| 2026-01-18 | 1.1 | Phase 1-3のスクリプト作成完了、PDCAチェックリスト更新 |
| 2026-01-18 | 1.2 | Phase 2完了（音素分析・コーパス選定実行完了）、Day 2のPDCA更新 |
| 2026-01-18 | 1.3 | Phase 3完了（データ前処理実行完了）、Day 3のPDCA更新、Phase 4のPlan作成 |